<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    {% extends 'base.html' %} 
    {% block Base %}
        <div class="buttonContainer">
            <h2 style="text-align:center">What is our machine Learning app?</h2>
            <button type="submit" onclick="beginRecording()"> Start Recording Audio </button>
            <button type="submit" onclick="stopRecording()"> Stop Recording Audio </button>
        </div>
        <div class="buttonContainer">
            <p class="displayReuslts">Results of analysis will be placed here</p>
        </div>

        <script>
            let mediaRecorder;
            let audioChunks = [];

            async function beginRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                    if (stream instanceof MediaStream) {
                        mediaRecorder = new MediaRecorder(stream);

                        mediaRecorder.ondataavailable = (event) => {
                            audioChunks.push(event.data);
                        };

                        mediaRecorder.onstop = async () => {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });

                            const formData = new FormData();
                            formData.append('audio', audioBlob);

                            try {
                                const response = await fetch('/analyzeData', {
                                    method: 'POST',
                                    body: formData
                                });

                                const result = await response.json();
                                console.log(result);
                            } catch (error) {
                                console.error('Error sending data to server:', error);
                            }
                        }

                        mediaRecorder.start();
                    } else {
                        console.error('Failed to obtain a valid MediaStream object.');
                    }
                } catch (error) {
                    console.error('Error getting user media:', error);
                }
            }

            function stopRecording() {
                mediaRecorder.stop();
            }
        </script>
    {% endblock %}
</body>
</html>
